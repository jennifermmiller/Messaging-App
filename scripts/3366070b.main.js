function clearModal(){$("#user-name").val(""),$("#user-pswd").val(""),$("#user-email").val(""),$("#user-avatar").empty(),$("#returning-user-name").val(""),$("#returning-user-pswd").val("")}function loadPage(){$(".left-side").show(),$(".message-stream-plus-header").show(),new UserView,messages.fetch({success:function(){messages.sort(),messages.each(function(a){new ListView({model:a})})}}),$("#start-app").hide(),$("#logout-btn").show()}var MessageClass=Parse.Object.extend("MessageClass"),MessagesCollection=Parse.Collection.extend({model:MessageClass,initialize:function(){this.on("add",function(a){new ListView({model:a})})},comparator:function(a){return a.get("createdAt")}}),LoginView=Parse.View.extend({createTemplate:_.template($("#login-template").text()),events:{"click #signup-btn":"signUpUser","click #login-btn":"logInUser"},initialize:function(){$("body").append(this.el),this.render()},render:function(){this.$el.html(this.createTemplate())},signUpUser:function(){var a=new Parse.User,b=$("#user-name").val(),c=$("#user-pswd").val(),d=$("#user-email").val();a.set("username",b),a.set("password",c),a.set("email",d);var e=$("#user-avatar")[0];if(e.files.length>0){var f=e.files[0],g="photo.jpg",h=new Parse.File(g,f);h.save().then(function(){a.set("avatar",h),a.save()})}else console.log("An error saving avatar occured.");a.signUp(null,{success:function(){currentUser=Parse.User.current()},error:function(a,b){console.log("Oopz! We could not sign you up!"+b)}}).then(function(){clearModal(),loadPage()})},logInUser:function(){var a=$("#returning-user-name").val(),b=$("#returning-user-pswd").val();Parse.User.logIn(a,b,{success:function(){currentUser=Parse.User.current()},error:function(a,b){console.log("Oopz! You could not be logged in!"+b)}}).then(function(){clearModal(),loadPage(),$(this).hide(),$("#logout-btn").show()})}}),MainView=Parse.View.extend({events:{"click #start-app":"lauchApp","click #logout":"logOut"},initialize:function(){this.messages=new MessagesCollection},lauchApp:function(){new LoginView},logOut:function(){Parse.User.logOut(),currentUser=Parse.User.current(),$(".left-side").hide(),$(".message-stream-plus-header").empty().hide(),$(this).hide(),$("#start-app").show()}}),UserView=Parse.View.extend({events:{"click #send-btn":"sendMsg"},template:_.template($("#user-template").text()),initialize:function(){$(".user-info").html(this.el),this.render()},render:function(){var a=this.template();this.$el.html(a)},sendMsg:function(){console.log("here?");var a=new MessageClass,b=$("#message-data").val(),c=currentUser.get("username"),d=moment().format("MMM Do YY, h:mm a");a.set("author",c),a.set("time",d),a.set("messageContents",b),messages.add(a),a.save(null,{successs:function(){console.log("Sweet! Message saved!")},error:function(a,b){console.log(b.description)}}),$("#message-data").val("")}}),ListView=Parse.View.extend({className:"message-row",events:{dblclick:"expand"},template:_.template($("#list-template").text()),initialize:function(){$(".message-stream").prepend(this.el),this.render(),this.on("add",this.collection,this.render)},render:function(){var a=this.template({model:this.model});this.$el.html(a)},expand:function(){this.$el.toggleClass("expand")}});console.log("Welcome!"),$(document).ready(function(){Parse.initialize("fTnob4g9ivFWWMunx5p5tq2X2Fp4U6T56uTzd96n","tMj1YBzrbJ4IIxCj72j7JVXy0VOVrFHJ6z9h7m4m"),window.messages=new MessagesCollection,$("#start-app").click(function(){new LoginView}),$("#logout-btn").click(function(){Parse.User.logOut(),currentUser=Parse.User.current(),$(".left-side").hide(),$(".message-stream-plus-header").hide(),$(this).hide(),$("#start-app").show()})});